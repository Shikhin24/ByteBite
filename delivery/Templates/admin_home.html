{% extends "base.html" %}
{% block title %}Admin | ByteBite{% endblock %}

{% block content %}
<div class="admin-layout">

    <!-- HEADER -->
    <header class="admin-header">
        <!-- TITLE AREA -->
        <div class="admin-title">
            <h1>Welcome, Admin</h1>
            <p>Manage restaurants and their menus from here.</p>
        </div>

        <div class="admin-topbar">
            <div class="admin-links">
                <a href="{% url 'logout' %}">Logout</a>
            </div>
        </div>
    </header>

    <!-- MAIN DASHBOARD -->
    <div class="admin-dashboard">

        <!-- LEFT: MAIN CONTENT -->
        <section class="admin-main">

            <!-- STATS -->
            <div class="admin-stats">
                <div class="stat">
                    <span class="stat-number">{{ restaurant_count }}</span>
                    <span class="stat-label">Restaurants</span>
                </div>
                <div class="stat">
                    <span class="stat-number">{{ menu_count }}</span>
                    <span class="stat-label">Menu Items</span>
                </div>
            </div>

            <!-- ACTIONS -->
            <div class="admin-actions">
                <a href="#" class="admin-card primary" id="openAddRestaurant">
                    <h3>Add Restaurant</h3>
                    <p>Create a new restaurant listing</p>
                </a>

                <a href="{% url 'show_restaurant' %}" class="admin-card">
                    <h3>View Restaurants</h3>
                    <p>Update, delete, or manage menus</p>
                </a>
            </div>

        </section>

        <!-- RIGHT: SIDEBAR -->
        <aside class="admin-sidebar">

            <div class="admin-panel">
                <h4>Recent Activity</h4>
                <ul>
                    {% for activity in activities %}
                    <li>
                        {{ activity.action }}
                        <span class="time">
                            - {{ activity.created_at|timesince }} ago
                        </span>
                    </li>
                    {% empty %}
                    <li class="muted">No recent activity</li>
                    {% endfor %}
                </ul>

            </div>
        </aside>

    </div>
</div>

<!-- ================= ADD RESTAURANT MODAL ================= -->
<div class="modal-overlay" id="addRestaurantModal">

  <div class="modal-card">
    <h2 style="text-align:center;">Add Restaurant</h2>

    {% if restaurant_error %}
      <div class="form-msg error">{{ restaurant_error }}</div>
    {% endif %}

    {% if restaurant_success %}
      <div class="form-msg success">{{ restaurant_success }}</div>
    {% endif %}

    <p class="muted" style="text-align:center;">
      Create a new restaurant listing
    </p>

    <form action="{% url 'add_restaurant' %}" method="POST">
      {% csrf_token %}

      <label>Restaurant name</label>
      <input type="text" name="name" required />

      <label>Picture URL</label>
      <input type="url" name="picture" required />

      <label>Location (Google Maps link)</label>
      <input type="url" name="location_url" />

      <label>Cuisine</label>
      <input type="text" name="cuisine" required />

      <label>Rating</label>
      <input type="number" step="0.1" min="0" max="5" name="rating" required />

      <button type="submit">Create Restaurant</button>
    </form>

</div>

<script>
  const openBtn = document.getElementById("openAddRestaurant");
  const modal = document.getElementById("addRestaurantModal");

  openBtn.addEventListener("click", (e) => {
    e.preventDefault();
    modal.classList.add("active");
    document.body.classList.add("modal-open");
  });

  modal.addEventListener("click", (e) => {
    if (e.target === modal) {
      modal.classList.remove("active");
      document.body.classList.remove("modal-open");
    }
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && modal.classList.contains("active")) {
      modal.classList.remove("active");
      document.body.classList.remove("modal-open");
    }
  });
</script>

{% endblock %}