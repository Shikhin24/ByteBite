{% extends "base.html" %}
{% block title %}{{ restaurant.name }} Menu{% endblock %}
{% block content %}
{% csrf_token %}
<h2>{{ restaurant.name }} Menu</h2>

{% if items %}
<table class="data-table">
  <tr>
    <th>Name</th>
    <th>Description</th>
    <th>Price</th>
    <th>Type</th>
    <th>Image</th>
  </tr>

  {% for item in items %}
  <tr>
    <td>{{ item.name }}</td>
    <td>{{ item.description }}</td>
    <td>â‚¹{{ item.price }}</td>
    <td>{% if item.nonVeg %} Non-Veg {% else %} Veg {% endif %}</td>
    <td>
      <img src="{{ item.picture }}" alt="{{ item.name }}" width="100" />
    </td>
    <td>
      {% if item.id in cart_item_ids %}
  <button disabled>Added âœ“</button>
{% else %}
  <button class="add-to-cart-btn" data-item-id="{{ item.id }}">
    Add to Cart
  </button>
{% endif %}

    </td>
  </tr>
  {% endfor %}
</table>
<br>
<a href="{% url 'view_cart' %}">Go to Cart</a>
<a href="{% url 'view_cart' %}">
  ðŸ›’ Cart <span id="cart-count">{{ cart_count }}</span>
</a>
{% else %}
<p>No menu available.</p>
{% endif %}

<br />
<a href="{% url 'customer_home' %}">Back to Restaurants</a>
<script>
  const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

  document.querySelectorAll('.add-to-cart-btn').forEach(button => {
    button.addEventListener('click', () => {
      const itemId = button.dataset.itemId;

      fetch(`/add-to-cart/${itemId}/`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': csrftoken,
        },
      })
      .then(res => res.json())
      .then(data => {
        // disable button
        button.innerText = "Added âœ“";
        button.disabled = true;

        // LIVE cart count update
        const cartCountEl = document.getElementById("cart-count");
        if (cartCountEl) {
          cartCountEl.innerText = data.cart_count;
        }
      })
      .catch(err => console.error(err));
    });
  });
</script>

{% endblock %}


